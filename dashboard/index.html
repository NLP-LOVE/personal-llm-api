<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>personal LLM Manage</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1"
    />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <link
      rel="stylesheet"
      title="default"
      href="/static/amis/6.13.0/sdk.min.css"
    />
    <link rel="stylesheet" href="/static/amis/6.13.0/helper.min.css" />
    <link rel="stylesheet" href="/static/fontawesome/7.0.1/all.min.css"/>
      <link rel="stylesheet" href="/static/fontawesome/7.0.1/v4-shims.min.css"/>
    <script src="/static/amis/6.13.0/sdk.min.js?v=3"></script>
    <script src="/static/js/vue.global.min.js"></script>
    <script src="/static/js/history.min.js"></script>
    <style>
      html,
      body,
      .app-wrapper {
        position: relative;
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
      }

      .cxd-AsideNav-itemLabel {
          font-size: 14px;
      }

      .cxd-PlainField {
          font-size: 14px;
      }

      .cxd-Crud-statistics {
          font-size: 16px;
      }

      .cxd-Pagination-wrap {
          font-size: 16px;
      }

      .cxd-AppBcn-item {
          font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div id="root" class="app-wrapper"></div>
    <script>
      (function () {
        let amis = amisRequire('amis/embed');
        const match = amisRequire('path-to-regexp').match;

        // å¦‚æœæƒ³ç”¨ browserHistory è¯·åˆ‡æ¢ä¸‹è¿™å¤„ä»£ç , å…¶ä»–ä¸ç”¨å˜
        // const history = History.createBrowserHistory();
        const history = History.createHashHistory();

        const app = {
          type: 'app',
          brandName: 'LLM Manage',
          logo: '/static/images/logo.png',
          header: {
            type: 'page',
            body: [
                {
                    "type": "flex",
                    "justify": "space-between",
                    "items": [
                        {
                            "type": "tpl",
                            "tpl": "."
                        },
                        {
                            "type": "tpl",
                            "tpl": "<span style='font-size: 20px;'>ğŸ“¢</span>&nbsp;<span style='font-size: 16px;'>Demo ç‰ˆæœ¬ï¼Œä»…ç”¨äºæ¼”ç¤ºï¼</span>",
                        },
                        {
                            "label": "é€€å‡ºç™»å½•",
                            "type": "button",
                            "icon": "fa fa-sign-out",
                            "actionType": "dialog",
                            "level": "danger",
                            "dialog": {
                              "title": "å¼¹æ¡†",
                              "body": "ç¡®å®šé€€å‡ºç™»å½•å—ï¼Ÿ",
                              "onEvent": {
                                  "confirm": {
                                    "actions": [
                                      {
                                        "actionType": "ajax",
                                        "api": "get:/backend/logout"
                                      },
                                      {
                                        "actionType": "refresh"
                                      }
                                    ]
                                  }
                              }
                            }
                        },
                    ],
                }
            ],
          },
          footer: '<div class="p-2 text-center bg-light" style="font-size: 14px !important;">Created by <a href="https://github.com/NLP-LOVE/personal-llm-api" target="_blank" style="font-color: #000000;">ğŸ±personal-llm-api</a></div>',
          asideBefore: '<div class="p-2 text-center"></div>',
          // asideAfter: '<div class="p-2 text-center">èœå•åé¢åŒºåŸŸ</div>',
          api: {
            "method": "get",
            "url": "/dashboard/aside.json",
            "headers": {
              "Cache-Control": "no-cache"
            }
          }
        };

        function normalizeLink(to, location = history.location) {
          to = to || '';

          if (to && to[0] === '#') {
            to = location.pathname + location.search + to;
          } else if (to && to[0] === '?') {
            to = location.pathname + to;
          }

          const idx = to.indexOf('?');
          const idx2 = to.indexOf('#');
          let pathname = ~idx
            ? to.substring(0, idx)
            : ~idx2
            ? to.substring(0, idx2)
            : to;
          let search = ~idx ? to.substring(idx, ~idx2 ? idx2 : undefined) : '';
          let hash = ~idx2 ? to.substring(idx2) : location.hash;

          if (!pathname) {
            pathname = location.pathname;
          } else if (pathname[0] != '/' && !/^https?\:\/\//.test(pathname)) {
            let relativeBase = location.pathname;
            const paths = relativeBase.split('/');
            paths.pop();
            let m;
            while ((m = /^\.\.?\//.exec(pathname))) {
              if (m[0] === '../') {
                paths.pop();
              }
              pathname = pathname.substring(m[0].length);
            }
            pathname = paths.concat(pathname).join('/');
          }

          return pathname + search + hash;
        }

        function isCurrentUrl(to, ctx) {
          if (!to) {
            return false;
          }
          const pathname = history.location.pathname;
          const link = normalizeLink(to, {
            ...location,
            pathname,
            hash: ''
          });

          if (!~link.indexOf('http') && ~link.indexOf(':')) {
            let strict = ctx && ctx.strict;
            return match(link, {
              decode: decodeURIComponent,
              strict: typeof strict !== 'undefined' ? strict : true
            })(pathname);
          }

          return decodeURI(pathname) === link;
        }

        let amisInstance = amis.embed(
          '#root',
          app,
          {
            location: history.location,
            data: {
              // å…¨å±€æ•°æ®ï¼Œæ˜¯å—æ§çš„æ•°æ®
            },
            context: {
              // å…¨å±€ä¸Šä¸‹æ–‡æ•°æ®, éå—æ§çš„æ•°æ®ï¼Œæ— è®ºå“ªä¸€å±‚éƒ½èƒ½è·å–åˆ°ï¼ŒåŒ…æ‹¬å¼¹çª—è‡ªå®šä¹‰æ•°æ®æ˜ å°„åéƒ½èƒ½è·å–åˆ°ã€‚
              // å¯ä»¥ç”¨æ¥æ”¾ä¸€ä¸‹å…¨å±€é…ç½®ç­‰ã€‚æ¯”å¦‚ API_HOST, è¿™æ ·é¡µé¢é…ç½®é‡Œé¢å¯ä»¥é€šè¿‡ ${API_HOST} æ¥è·å–åˆ°ã€‚
              API_HOST: 'https://3xsw4ap8wah59.cfc-execute.bj.baidubce.com'
            }
          },
          {
            // watchRouteChange: fn => {
            //   return history.listen(fn);
            // },
            updateLocation: (location, replace) => {
              location = normalizeLink(location);
              if (location === 'goBack') {
                return history.goBack();
              } else if (
                (!/^https?\:\/\//.test(location) &&
                  location ===
                    history.location.pathname + history.location.search) ||
                location === history.location.href
              ) {
                // ç›®æ ‡åœ°å€å’Œå½“å‰åœ°å€ä¸€æ ·ï¼Œä¸å¤„ç†ï¼Œå…å¾—é‡å¤åˆ·æ–°
                return;
              } else if (/^https?\:\/\//.test(location) || !history) {
                return (window.location.href = location);
              }

              history[replace ? 'replace' : 'push'](location);
            },
            jumpTo: (to, action) => {
              if (to === 'goBack') {
                return history.goBack();
              }

              to = normalizeLink(to);

              if (isCurrentUrl(to)) {
                return;
              }

              if (action && action.actionType === 'url') {
                action.blank === false
                  ? (window.location.href = to)
                  : window.open(to, '_blank');
                return;
              } else if (action && action.blank) {
                window.open(to, '_blank');
                return;
              }

              if (/^https?:\/\//.test(to)) {
                window.location.href = to;
              } else if (
                (!/^https?\:\/\//.test(to) &&
                  to === history.pathname + history.location.search) ||
                to === history.location.href
              ) {
                // do nothing
              } else {
                history.push(to);
              }
            },
            isCurrentUrl: isCurrentUrl,
            theme: 'cxd'
          }
        );

        history.listen(state => {
          amisInstance.updateProps({
            location: state.location || state
          });
        });
      })();
    </script>
  </body>
</html>
